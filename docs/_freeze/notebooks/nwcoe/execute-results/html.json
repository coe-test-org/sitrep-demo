{
  "hash": "0714337545cb256d71ab52cf813b0447",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: NorthWest Genomics Center of Excellence\ndate: 4/26/2024\ndate-modified: today\n---\n\n\n\n\n\n\n# Set Up\n\nThis project uses an R environment (`renv`) to save all the packages/versions used in the scripts. \n\nTo install the packages;\n\n1.    Please upgrade to `renv` version 1.0.5 or higher\n2.    At the root of the project/your local clone, run `renv::restore()`\n3.    This should install all the packages required\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# ----- Load Libraries ----- #\n## ---- libraries\nlibrary(pacman)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'pacman' was built under R version 4.2.3\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\np_load(\n  fs,\n  lubridate,\n  dplyr,\n  stringr,\n  magrittr,\n  readr,\n  httr,\n  readxl,\n  ggplot2,\n  ggtext,\n  ggthemes,\n  forcats,\n  here\n)\n## ---- stop\n```\n:::\n\n\n\n\n\n\n# Read in DOH Data\n\nThese data are public and can be found on the WA DOH resp illness dashboard [under sequencing/variants](https://doh.wa.gov/data-and-statistical-reports/diseases-and-chronic-conditions/communicable-disease-surveillance-data/respiratory-illness-data-dashboard#downloads)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# ----- Pull DOH Public Dashboard Data ----- #\n\n## ---- pull-data\n(\n  variants <- read_xlsx(file.path(\"data/Downloadable_variant.xlsx\")) %>%\n    rename(c(\"start_date\" = `Start Date`,\n             \"end_date\" = `End Date`,\n             \"variant\" = `Variant`,\n             \"seven_day_count\" = `7-Day Sequence Count`,\n             \"seven_day_percent\" = `7-Day Percent`,\n             \"datetime\" = `Date/Time Updated`)) %>%\n    # make the date ranges for the plot\n    # group each date range\n    group_by(start_date,end_date) %>%\n    # assign each date range an id wtih dplyr::cur_group_id()\n    mutate(group_id = cur_group_id()) %>%\n    # create labels for the groups\n    mutate(group_label = paste(start_date, \" - \\n\", end_date)) %>%\n    # add % to the percent labels\n    mutate(percent_label = paste0(seven_day_percent,\"%\")) %>%\n    ungroup()\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 78 × 9\n   start_date          end_date            variant    seven_day_count\n   <dttm>              <dttm>              <chr>                <dbl>\n 1 2023-04-30 00:00:00 2023-05-13 00:00:00 BA.2.75                  2\n 2 2023-04-30 00:00:00 2023-05-13 00:00:00 BA.5                     1\n 3 2023-04-30 00:00:00 2023-05-13 00:00:00 BN.1                     1\n 4 2023-04-30 00:00:00 2023-05-13 00:00:00 CH.1.1                   4\n 5 2023-04-30 00:00:00 2023-05-13 00:00:00 EG.5                     2\n 6 2023-04-30 00:00:00 2023-05-13 00:00:00 XBB                      8\n 7 2023-04-30 00:00:00 2023-05-13 00:00:00 XBB.1.16                27\n 8 2023-04-30 00:00:00 2023-05-13 00:00:00 XBB.1.16.1               7\n 9 2023-04-30 00:00:00 2023-05-13 00:00:00 XBB.1.5                 90\n10 2023-04-30 00:00:00 2023-05-13 00:00:00 XBB.1.5.1                2\n# ℹ 68 more rows\n# ℹ 5 more variables: seven_day_percent <dbl>, datetime <dttm>, group_id <int>,\n#   group_label <chr>, percent_label <chr>\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n## ---- stop\n```\n:::\n\n\n\n\n\n\n# Variant Plot\n\nThis should produce a similar variant plot to what's in the dashboard\n\n\n\n\n\n\n::: {#cell-fig-countprop .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-countprop\n#| fig-cap: \"Proportion of variants by year.\"\n\n# ----- Make Variant Plot ----- #\n\n## ---- var-plot\n(\n  variants %>%\n    ggplot(aes(y=seven_day_percent,\n               x=group_label,\n               fill=variant,\n               label=percent_label)) +\n    geom_bar(position=\"stack\", stat=\"identity\") +\n    geom_text(\n      aes(\n        label=ifelse(\n          seven_day_percent>4.0,\n          percent_label,\n          \"\"\n          )\n        ),\n      size = 3,\n      position = position_stack(vjust = 0.5),\n      color=\"white\") +\n    scale_fill_viridis_d(na.value = \"red\") +\n    # Add percent sign \n    scale_y_continuous(labels = function(x) paste0(x, \"%\")) +\n    labs(\n         # Without the caption, the dates get cut off in the email..\n         caption = \"\",\n         x = \"Specimen Collection Date\",\n         y = \"\",\n         title = \"<b><span style = 'font-size:14pt;'>Statewide COVID-19 Variants: Last 12 Weeks</span></b><br>This chart shows the percent of genetic mutations (or variants) of the COVID-19 virus by lineage for the past 6 weeks. Knowing how the virus is changing and which variants are found helps inform our public health response, which includes developing and recommending effective vaccines and treatments\") +\n    theme_bw() +\n    theme(\n      # take out the default background\n      strip.background  = element_blank(),\n      # Adjust where the legend is an put a sick background behind it\n      legend.position = 'right',\n      legend.background = element_rect(fill = \"lightblue\",\n                                       linetype = \"solid\",\n                                       color = \"darkblue\",\n                                       linewidth = 1),\n      legend.direction = \"vertical\", legend.box = \"horizontal\",\n      plot.title.position = \"plot\",\n      plot.title = element_textbox_simple(\n        maxwidth = unit(6,\"in\"),\n        hjust = .0005,\n        size = 10,\n        padding = margin(5.5, 5.5, 5.5, 5.5),\n        margin = margin(0, 0, 5.5, 0),\n        fill = \"cornsilk\"\n      )) +\n    # Again adjust where the legend should be and how it should be labeled\n    guides(fill = guide_legend(title = \"Variants\", \n                               title.position = \"top\",\n                               title.hjust = .5,\n                               byrow = TRUE,\n                               override.aes = list(size=5.5)),\n           size = guide_legend( )) \n)\n\n## ---- stop\n```\n\n::: {.cell-output-display}\n![Proportion of variants by year.](nwcoe_files/figure-html/fig-countprop-1.png){#fig-countprop width=672}\n:::\n:::\n",
    "supporting": [
      "nwcoe_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}